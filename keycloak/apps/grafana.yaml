---
helmfiles:
  - path: git::https://github.com/stuttgart-things/helm.git@monitoring/grafana.yaml.gotmpl
    values:
      - ingressEnabled: true
      - hostname: grafana
      - domain: 172.18.0.4.nip.io
      - storageClassName: standard
      - size: 1 # storage size in Gi
      - clusterIssuer: selfsigned
      - grafanaConfig: |
          server:
            protocol: http
            root_url: https://grafana.172.18.0.4.nip.io
            serve_from_sub_path: false
          auth.generic_oauth:
            enabled: true
            name: Keycloak
            allow_sign_up: true
            client_id: grafana
            scopes: openid profile email
            auth_url: http://keycloak-deployment.keycloak.svc.cluster.local/realms/grafana/protocol/openid-connect/auth
            token_url: http://keycloak-deployment.keycloak.svc.cluster.local/realms/grafana/protocol/openid-connect/token
            api_url: http://keycloak-deployment.keycloak.svc.cluster.local/realms/grafana/protocol/openid-connect/userinfo
            role_attribute_path: contains(groups[*], 'grafana-admin') && 'Admin' || 'Viewer'
            tls_skip_verify_insecure: true