---
version: 3

tasks:
  static-lint-all:
    desc: Lint/validate multiple technologies
    vars:
      MODULE: github.com/stuttgart-things/blueprints/repository-linting@v1.21.0
      FUNCTION: validate-multiple-technologies
      EXPORT_PATH: /tmp/all-findings.txt
      CODE_DIR:
        sh: |
          gum input --placeholder "Source code dir" --value $(pwd)
    cmds:
      - |
        dagger call -m {{ .MODULE }} {{ .FUNCTION }} \
        --src {{ .CODE_DIR }} \
        export --path {{ .EXPORT_PATH }}

  run-all-static-tests:
    desc: Lint/validate multiple technologies
    vars:
      MODULE: github.com/stuttgart-things/blueprints/go-microservice@v1.21.0
      FUNCTION: run-static-stage
      EXPORT_PATH: /tmp/all-findings.txt
      CODE_DIR:
        sh: |
          gum input --placeholder "Source code dir" --value $(pwd)

    cmds:
      - |
        dagger call -m {{ .MODULE }} {{ .FUNCTION }} \
        --src {{ .CODE_DIR }} \
        --lintCanFail=$(gum choose "true" "false" --header "Allow lint to fail?") \
        --test=$(gum choose "true" "false" --header "Enable tests?") \
        --progress plain -vv \
        export --path=/tmp/$(basename {{ .CODE_DIR }})-static-tests-findings.txt
        code /tmp/$(basename {{ .CODE_DIR }})-static-tests-findings.txt
